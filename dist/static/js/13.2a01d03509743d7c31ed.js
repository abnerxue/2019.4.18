webpackJsonp([13],{Nwco:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("woOf"),r=a.n(n),s=a("Xxa5"),i=a.n(s),l=a("exGp"),c=a.n(l),o=a("mvHQ"),d=a.n(o),h=a("zMP6"),u=a("pgfl"),p=a("cMGX"),m={name:"",components:{AutoSearch:u.a,Pagination:p.a},data:function(){return{tableHeight:50,loading:!1,searchKey:"",list:[],page:{pageSize:10,pageNo:1,totalCount:0,totalPage:0},choose:{id:"",label:""},currentRow:null,tabIndex:0,searchList:[],applicableList:[],treatment:{},oldTreatment:{},treatmentType:[{id:0,desp:"7天"},{id:1,desp:"30天"},{id:2,desp:"自定义"}]}},created:function(){this.getAllMedcine(),this.getAllList()},mounted:function(){var e=this;setTimeout(function(){e.tableHeight=window.innerHeight-350},100)},methods:{handleSearch:function(){this.getAllList(this.searchKey),this.choose={id:"",label:""}},handleClickRow:function(e){var t=this,a=!0;if(1===this.tabIndex&&this.treatment.id>0&&(a=this.oldTreatment===d()(this.treatment)),!a)return this.$confirm("当前页面未保存，是否确认离开？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.choose={id:e.id,label:e.diagnosisName},t.treatment={},t.handleData(t.tabIndex),t.currentRow=e}).catch(function(){t.$refs.table.setCurrentRow(t.currentRow)});this.choose={id:e.id,label:e.diagnosisName},this.treatment={},this.handleData(this.tabIndex),this.currentRow=e},beforeLeave:function(e){var t=this,a=!0;if(1===this.tabIndex&&this.treatment.id>0&&(a=this.oldTreatment===d()(this.treatment)),!a)return this.$confirm("当前页面未保存，是否确认离开？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.tabIndex=Number(e),t.handleData(t.tabIndex)}).catch(function(){throw console.log("cancle"),new Error("cancle")});this.tabIndex=Number(e),this.handleData(this.tabIndex)},handleData:function(e){0===e?this.getApplicableList():1===e&&this.getTreatment()},handleDelete:function(e){var t=this;this.$confirm("确定删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.deleteApplicable(e)}).catch(function(){})},deleteApplicable:function(e){var t=this;return c()(i.a.mark(function a(){var n;return i.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(h.j)({id:e});case 2:0===(n=a.sent).code?(t.$message.success("删除成功!"),t.getApplicableList()):t.$message.error(n.msg);case 4:case"end":return a.stop()}},a,t)}))()},handleAdd:function(e){var t=this;return c()(i.a.mark(function a(){var n,r;return i.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return n={diagnosisId:t.choose.id,medcineId:e.id},a.next=3,Object(h.a)(n);case 3:0===(r=a.sent).code?t.getApplicableList():t.$message.error(r.msg);case 5:case"end":return a.stop()}},a,t)}))()},handleSave:function(){var e=this;return c()(i.a.mark(function t(){var a;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.loading=!0,t.next=3,Object(h.C)(e.treatment);case 3:a=t.sent,e.loading=!1,0===a.code?(e.$message.success(a.msg),e.getTreatment()):e.$message.error(a.msg);case 6:case"end":return t.stop()}},t,e)}))()},getApplicableList:function(){var e=this;return c()(i.a.mark(function t(){var a;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(h.q)({diagnosisId:e.choose.id});case 2:0===(a=t.sent).code?e.applicableList=a.result:e.$message.error(a.msg);case 4:case"end":return t.stop()}},t,e)}))()},getTreatment:function(){var e=this;return c()(i.a.mark(function t(){var a;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(h.A)({diagnosisId:e.choose.id});case 2:0===(a=t.sent).code&&(e.treatment=a.result[0]||e.treatment,e.oldTreatment=d()(e.treatment));case 4:case"end":return t.stop()}},t,e)}))()},getAllList:function(e){var t=this;return c()(i.a.mark(function a(){var n,r;return i.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return n={filter:e,pageNo:t.page.pageNo,pageSize:t.page.pageSize},a.next=3,Object(h.z)(n);case 3:0===(r=a.sent).code?(t.list=r.result,t.page=r.page||t.page):t.$message.error(r.msg);case 5:case"end":return a.stop()}},a,t)}))()},getAllMedcine:function(){var e=this;return c()(i.a.mark(function t(){var a;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(h.h)();case 2:0===(a=t.sent).code&&(e.allMedcine=a.result,e.searchList=JSON.parse(d()(e.allMedcine)),e.searchList.forEach(function(e){r()(e,{value:e.name})}));case 4:case"end":return t.stop()}},t,e)}))()},tableHeaderName:function(e){e.row,e.rowIndex;return"table-header"}}},f=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{height:"100%"}},[a("el-row",{staticStyle:{height:"100%"},attrs:{gutter:20}},[a("el-col",{staticStyle:{height:"100%"},attrs:{span:10}},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",{staticClass:"f4"},[e._v("诊断列表")])]),e._v(" "),a("div",[a("el-input",{attrs:{size:"small",placeholder:"查找诊断",clearable:""},on:{change:e.handleSearch},model:{value:e.searchKey,callback:function(t){e.searchKey=t},expression:"searchKey"}}),e._v(" "),a("div",{staticClass:"space"}),e._v(" "),a("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{data:e.list,"highlight-current-row":"",border:"",size:"small",height:e.tableHeight,"header-cell-class-name":e.tableHeaderName},on:{"row-click":e.handleClickRow}},[a("el-table-column",{attrs:{prop:"icd10",label:"编码",align:"center",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{prop:"diagnosisName",label:"名称",align:"center"}})],1),e._v(" "),a("Pagination",{staticClass:"text-center",attrs:{page:e.page},on:{handlePageChange:e.getAllList}})],1)])],1),e._v(" "),a("el-col",{staticStyle:{height:"100%"},attrs:{span:14}},[a("el-card",{staticClass:"box-card",staticStyle:{height:"100%"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",{staticClass:"f4"},[e._v("适用药")]),e._v(" "),e.choose.label?a("span",{staticClass:"f1 font-bold"},[e._v("【 "+e._s(e.choose.label)+" 】")]):e._e()]),e._v(" "),e.choose.label?e._e():a("div",{staticClass:"f4"},[e._v("请先选择药品")]),e._v(" "),e.choose.label?a("el-tabs",{attrs:{"before-leave":e.beforeLeave}},[a("el-tab-pane",{attrs:{label:"适用药品"}},[a("AutoSearch",{attrs:{placeHolder:"添加药品",list:e.searchList},on:{handleSelect:e.handleAdd}}),e._v(" "),a("div",{staticClass:"space"}),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.applicableList,border:"",size:"small",height:e.tableHeight,"header-cell-class-name":e.tableHeaderName}},[a("el-table-column",{attrs:{prop:"medcineName",label:"药品通用名",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"enable",label:"操作",align:"center",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("i",{staticClass:"el-icon-delete text-red pointer",on:{click:function(a){return e.handleDelete(t.row.id)}}})]}}])})],1)],1),e._v(" "),a("el-tab-pane",{attrs:{label:"疗程设置"}},[e.treatment.id?a("el-form",{attrs:{model:e.treatment,size:"small","label-width":"85px"}},[a("el-form-item",{attrs:{label:"疗程时间："}},[a("el-radio-group",{model:{value:e.treatment.type,callback:function(t){e.$set(e.treatment,"type",t)},expression:"treatment.type"}},e._l(e.treatmentType,function(t,n){return a("el-radio",{key:n,attrs:{label:t.id}},[e._v("\n                    "+e._s(t.desp)+"\n                    "),2===t.id&&2===e.treatment.type?[a("el-input",{staticStyle:{width:"80px"},attrs:{size:"small",placeholder:"",type:"number"},model:{value:e.treatment.duration,callback:function(t){e.$set(e.treatment,"duration",t)},expression:"treatment.duration"}}),e._v("天\n                    ")]:e._e()],2)}),1)],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.handleSave}},[e._v("保存")])],1)],1):a("p",{staticClass:"f6"},[e._v("无诊断疗程信息~")])],1)],1):e._e()],1)],1)],1)],1)};f._withStripped=!0;var g={render:f,staticRenderFns:[]},b=g;var v=a("VU/8")(m,b,!1,null,null,null);v.options.__file="src/view/rule/maintain.vue";t.default=v.exports}});
//# sourceMappingURL=13.2a01d03509743d7c31ed.js.map