<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ck.springboot.mapper.LabelManagerMapper">
	<insert id="addLabel" parameterType="String">
		insert into t_label (name) values (#{name})
	</insert>
	
	<select id="getLabelCountsByName" parameterType="String" resultType="Integer">
		select count(1) from t_label where name = #{name}
	</select>

	<update id="updateLabelName">
		update t_label set name = #{name} where id =#{id}
	</update>

	<select id="getNameById" parameterType="int" resultType="String">
		select name from t_label where id = #{id}
	</select>
<!-- 	查询标签数量 -->
	<select id="getLabelCount" parameterType="String" resultType="int">
		select count(*) from t_label where 1=1
		<if test="name != null">
			and name like ('%'+#{name}+'%')
		</if>
	</select>
	<select id="getLabelList" parameterType="String" resultType="com.ck.springboot.pojo.Label">
		select top ${pageSize} t.* from t_label t
		where 1=1 and t.id not in (select top (${pageSize}*(${pageNo}-1)) id from t_label where 1=1
		<if test="name != null">
			and name like ('%'+#{name}+'%')
		</if>) 

		<if test="name != null">
			and name like ('%'+#{name}+'%')
		</if>

	</select>
	
	<delete id="deleteLabelById" parameterType="int">
		delete from t_label where id = #{id}
	</delete>
	
	<select id="getMedicineListByLabelId" parameterType="int" 
			resultType="com.ck.springboot.pojo.Label">
		select top ${pageSize} tl.*,tm.id as medicineId,tm.name as medicineName
		from t_label tl
		inner join t_lbl_medcine tlm on (tl.id = tlm.label_id)
		inner join t_medcine tm on (tlm.medcine_id = tm.id)
		where tl.id = #{id} and tm.id not in (select top (${pageSize}*(${pageNo}-1)) 
		tm.id
		from t_label tl
		inner join t_lbl_medcine tlm on (tl.id = tlm.label_id)
		inner join t_medcine tm on (tlm.medcine_id = tm.id)
		where tl.id = #{id})
	</select>
	
	<select id="getMedicineCountsByLabelId" parameterType="int" resultType="int">
		select count(1) from t_lbl_medcine where label_id = #{labelId}
	</select>
	
	<delete id="deleteLabelAndMedicine" parameterType="int">
		delete from t_lbl_medcine where label_id = #{lid}
	</delete>
	
	<insert id="addLabelAndMedicine">
		insert into t_lbl_medcine (medcine_id,label_id) values (#{medcineId},#{labelId})
	</insert>
	


</mapper>

